<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Extract feature importance • tiDML</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extract feature importance">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tiDML</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Default Models</h6></li>
    <li><a class="dropdown-item" href="../articles/neural-network.html">Neural Network</a></li>
    <li><a class="dropdown-item" href="../articles/random-forest.html">Random Forest</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>How-to</h6></li>
    <li><a class="dropdown-item" href="../articles/user-defined-recipies.html">Set your own model</a></li>
    <li><a class="dropdown-item" href="../articles/examine-outputs.html">Examine model outputs</a></li>
    <li><a class="dropdown-item" href="../articles/feature-importance.html">Extract feature importance</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Replication</h6></li>
    <li><a class="dropdown-item" href="../articles/package-replication.html">DoubleML Package</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/justinberesford/tiDML/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Extract feature importance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/justinberesford/tiDML/blob/master/vignettes/feature-importance.Rmd" class="external-link"><code>vignettes/feature-importance.Rmd</code></a></small>
      <div class="d-none name"><code>feature-importance.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="storing-fitted-models">Storing fitted models<a class="anchor" aria-label="anchor" href="#storing-fitted-models"></a>
</h2>
<p>In either the default <code>dml_XX()</code> functions, or when
running a custom <code><a href="../reference/run_dml.html">run_dml()</a></code>, you have the option to store
all fitted models (across both folds and reps) by setting
<code>store_models = TRUE</code>. This allows you to extract feature
importance measures from the underlying models.</p>
<p>Warning: this can use a lot of memory, especially if you are using a
large number of folds and reps.</p>
<div class="section level4">
<h4 id="store_models-true">
<code>store_models = TRUE</code><a class="anchor" aria-label="anchor" href="#store_models-true"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/justinberesford/tiDML" class="external-link">tiDML</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diamonds_sample.html">diamonds_sample</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">500</span>, seed<span class="op">=</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dml_rf.html">dml_rf</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"price"</span>,</span>
<span>  d <span class="op">=</span> <span class="st">"is_rated_ideal"</span>,</span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"carat"</span>, <span class="st">"depth"</span>, <span class="st">"table"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>,</span>
<span>  n_folds <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  n_rep <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  store_models <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="extracting-feature-importance">Extracting feature importance<a class="anchor" aria-label="anchor" href="#extracting-feature-importance"></a>
</h2>
<p>Feature importance can be only be extracted for tree based models
(decision trees, random forests, or gradient boosted trees). For Lasso
regression, the coefficients themselves can be used to assess variable
importance.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"not yet implemented"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "not yet implemented"</span></span></code></pre></div>
<p>The function <code>get_feature_importance()</code> extracts feature
importance measures from all the fitted models and returns a tidy data
frame.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feature_importance</span> <span class="op">&lt;-</span> <span class="fu">get_feature_importance</span><span class="op">(</span><span class="va">fit_rf</span>, model <span class="op">=</span> <span class="st">"outcome"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">feature_importance</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 90 × 4</span></span></span>
<span><span class="co">#&gt;    rep     fold  variable  importance</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Repeat1 Fold1 carat    <span style="text-decoration: underline;">1</span>476<span style="text-decoration: underline;">530</span>170.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Repeat1 Fold1 depth     129<span style="text-decoration: underline;">023</span>204.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Repeat1 Fold1 table      97<span style="text-decoration: underline;">344</span>033.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Repeat1 Fold1 x        <span style="text-decoration: underline;">1</span>438<span style="text-decoration: underline;">006</span>224.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Repeat1 Fold1 y        <span style="text-decoration: underline;">1</span>385<span style="text-decoration: underline;">954</span>655.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Repeat1 Fold1 z        <span style="text-decoration: underline;">1</span>291<span style="text-decoration: underline;">377</span>574.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Repeat1 Fold2 carat    <span style="text-decoration: underline;">1</span>333<span style="text-decoration: underline;">627</span>279.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Repeat1 Fold2 depth     130<span style="text-decoration: underline;">770</span>570.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Repeat1 Fold2 table     110<span style="text-decoration: underline;">364</span>172.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Repeat1 Fold2 x        <span style="text-decoration: underline;">1</span>374<span style="text-decoration: underline;">728</span>139.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 80 more rows</span></span></span></code></pre></div>
<p>You can average importance across folds and reps, or plot the feature
importance as a distribution.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">feature_importance</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">importance</span>, <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">importance</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"#425a7f"</span>, colour<span class="op">=</span><span class="st">"#425a7f"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Distribution of importance across folds"</span>, y<span class="op">=</span><span class="st">"Feature"</span><span class="op">)</span></span></code></pre></div>
<p><img src="feature-importance_files/figure-html/feature-importance-plot-1.png" alt="Feature importance plot" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Justin Beresford.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
