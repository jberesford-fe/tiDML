---
title: "Introduction to tiDML"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to tiDML}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r knit-options, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
# First pass with tiDML

In the simplest case, you can use the package under complete default settings. Pick a model, specify data, outcome variable, treatment variable, and covariates, and hit go. Currently, the default models available are:

- `dml_rf()` for random forest, and
- `dml_nnet()` for a neural network.

Here I use the `diamonds` data from `ggplot2` to estimate the effect of being rated "ideal" on a diamonds price, after having controlled for caret, depth, etc.


```{r simple}
library(tiDML)

df <- diamonds_sample(n=10000)

fit_rf <- dml_rf(
  data = df,
  y = "price",
  d = "is_rated_ideal",
  x = c("carat", "depth", "table", "x", "y", "z"),
)

fit_rf$estimate
```

# Checking inputs and outputs

A benefit of using `tiDML` (and the `tidymodels` ecosystem more generally) is that you can rely on packages like `generics` and `workflows` to examine the inputs and outputs of your model.

## `tidy()`, `glance()` and `augment()`
To get a quick overview of the results, you can use the `tidy()` or `augment()` functions from `generics` which will return, respectively:

- a tibble with the point estimate, standard error, t-value, p-value, and confidence interval.
- a tibble with the inputs and settings used for the DML estimation, and
- a tibble with the original data, predicted values, and residuals for the outcome and treatment variables.

```{r examine-output}
# Coefficients and standard errors
tidy(fit_rf)

# Summary of model inputs and settings
glance(fit_rf)

# Original data, predicted values, and residuals
augment(fit_rf)
```

## Examine the workflow (recipe and model specs)

The workflows package is used to manage the preprocessing and model fitting steps. You can extract the (unfitted) workflow object and examine it. *Note that while the fitted workflow can be extracted, isn't useful here since DML uses cross-fitting.* 

```{r examine-workflow}
# Examine the treatment model workflow
fit_rf$m_workflow

# Examine the outcome model workflow
fit_rf$g_workflow
```

Much more detail is given in the Articles section. See `vignette("examine-outputs")`.
