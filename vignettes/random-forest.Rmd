---
title: "Random Forest"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Random Forest}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r knit-options, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Load packages and data
```{r setup, warnings=FALSE, message=FALSE}
library(tiDML)
library(dplyr)
```

# Random forest with default settings

Import small sample of data from ggplot2's diamonds dataset (500 rows).
```{r rf-default}
df <- diamonds_sample(n=500, seed=123)
```

The most basic setup for Random Forest is:

``` {r base-rf, evaluate=FALSE}
fit_rf <- dml_rf(
  data = df,
  y = "price",
  d = "is_rated_ideal",
  x = c("carat", "depth", "table", "x", "y", "z"),
)
```


# Random Forest with custom settings

You can also customise the default `dml_rf()` to some degree. Here I set a custom grid of number of trees to try during hyperparameter tuning (NB this tests 100 and 200, rather than everything in between). You can also set the number of folds for cross-fitting and the type of robust standard errors to use (choice of "HC0", "HC1", "HC2", "HC3", or "HC4").

```{r rf-custom, warnings=FALSE, message=FALSE}
fit_rf <- dml_rf(
  data = df,
  y = "price",
  d = "is_rated_ideal",
  x = c("carat", "depth", "table", "x", "y", "z"),
  n_folds = 5,
  n_rep = 3,
  vcov_type = "HC2",
  trees_grid = c(100, 200))

library(generics)
tidy(fit_rf)

```